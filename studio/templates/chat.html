<!DOCTYPE html>
<html>
<head>
    <title>{{ agent | capitalize }} Chat</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#007bff',
                    }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="/static/styles.css">
    <script>
        if (localStorage.getItem("theme") === "dark") {
            document.documentElement.classList.add("dark");
        }
    </script>
</head>
<body class="bg-white dark:bg-gray-900 text-gray-800 dark:text-gray-100 min-h-screen">
    
    <!-- Theme toggle -->
    <button onclick="toggleTheme()" class="fixed top-3 right-4 z-50 px-3 py-1 border-2 border-primary text-primary rounded-full bg-white dark:bg-gray-800">ğŸŒ“</button>

    <!-- Sidebar -->
    <div class="fixed top-0 left-0 h-full w-60 bg-white dark:bg-gray-800 p-4 shadow-md z-40 transition-all sidebar">
        <a href="/" class="block text-blue-600 dark:text-blue-400 font-semibold mb-4">â† Home</a>

        <h2 class="text-sm font-bold uppercase mb-2 text-gray-700 dark:text-gray-300">ğŸ¤– Explore Agents</h2>
        {% for id, model in models.items() %}
        <a href="/chat/{{ id }}" class="flex items-center gap-2 text-sm text-blue-600 dark:text-blue-400 mb-2 hover:underline">
            <span>ğŸ§ </span>
            <span>{{ model.label }}</span>
        </a>
        {% endfor %}

        <h2 onclick="toggleConvoList()" class="text-sm font-bold uppercase mt-6 cursor-pointer text-gray-700 dark:text-gray-300">
            ğŸ—‚ Conversations âŒ„
        </h2>
        <div id="conversationList" class="pl-2 mt-2 space-y-1">
            {% for cname in conversations.keys() %}
            <a href="/chat/{{ agent }}?conversation_name={{ cname }}" class="flex items-center gap-2 text-sm text-gray-700 dark:text-gray-300 hover:underline">
                <span>ğŸ“</span>
                <span>{{ cname }}</span>
            </a>
            {% endfor %}
        </div>
    </div>

    <!-- Sidebar toggle -->
    <button class="fixed top-2 left-64 z-50 bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700 sidebar-toggle" onclick="document.body.classList.toggle('collapsed')">â˜°</button>

    <!-- Chat Container -->
    <div class="ml-64 p-6 pb-32 transition-all chat-container">
        {% if response %}
        <div class="bg-white dark:bg-gray-800 p-4 mb-4 rounded-lg shadow text-gray-900 dark:text-gray-100 border-l-4 border-blue-500">
            <strong>You:</strong><br>{{ user_input }}
        </div>
        <div class="bg-gray-100 dark:bg-gray-700 p-4 mb-4 rounded-lg shadow text-gray-900 dark:text-gray-100 border-l-4 border-green-500 relative">
            <strong>AI:</strong><br>{{ response }}
            <button class="absolute top-2 right-2 w-7 h-7 rounded-full bg-primary text-white text-xs flex items-center justify-center" title="Generate Doc">W</button>
        </div>
        {% else %}
        <div class="text-center text-gray-400">Start a conversation</div>
        {% endif %}
    </div>

    <!-- Input Form -->
    <form method="post" class="fixed bottom-0 left-64 right-0 bg-white dark:bg-gray-800 p-4 flex gap-3 border-t border-gray-200 dark:border-gray-700 z-50">
        {% if not conversation_name %}
        <input type="text" name="conversation_name" placeholder="Name this conversation..." required
               class="px-4 py-2 flex-1 rounded border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-900 text-gray-800 dark:text-gray-100" />
        {% else %}
        <input type="hidden" name="conversation_name" value="{{ conversation_name }}" />
        {% endif %}
        <textarea name="user_input" id="user_input" rows="2" placeholder="Send a message..." required
                  class="px-4 py-2 flex-1 rounded border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-900 text-gray-800 dark:text-gray-100 resize-none"></textarea>
        <button type="submit" onclick="submitChat()"
                class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">â¤</button>
    </form>

    <!-- Scripts -->
    <script>
        function toggleTheme() {
            document.body.classList.toggle("dark");
            localStorage.setItem("theme", document.body.classList.contains("dark") ? "dark" : "light");
        }

        function toggleConvoList() {
            const el = document.getElementById("conversationList");
            el.style.display = el.style.display === "none" ? "block" : "none";
        }

        window.onload = () => {
            if (localStorage.getItem("theme") === "dark") {
                document.body.classList.add("dark");
            }
            const textarea = document.getElementById("user_input");
            if (textarea) {
                textarea.addEventListener("keydown", function (event) {
                    if (event.key === "Enter" && !event.shiftKey) {
                        event.preventDefault();
                        this.form.submit();
                    }
                });
            }
        }
    </script>
</body>
</html>
